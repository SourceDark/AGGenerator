/**
 * Created by Nettle on 2017/2/22.
 */

(function () {
    'use strict';

    angular.module('BlurAdmin.pages.vulnerability.detail', [])
        .config(routeConfig)
        .controller('detailCtrl', function ($scope, $http, $stateParams, $window) {
            $scope.goBack = function () {
                $window.history.back();
            };
            $scope.vul = $stateParams.vulnerability;
            if (!$scope.vul) {
                $http
                    .get([$scope.apiUrl, 'server', $scope.networkId, 'vulnerabilities'].join('/'))
                    .then(function (result) {
                        for (var i in result.data)
                            if (result.data[i].id == $stateParams.id) {
                                $scope.vul = result.data[i];
                                break;
                            }
                    }, function (result) {
                        console.error('获取漏洞列表失败');
                    });
            }
        });

    /** @ngInject */
    function routeConfig($stateProvider) {
        $stateProvider
            .state('vulnerability.detail', {
                url: '/detail/{id}',
                params: {vulnerability: null},
                templateUrl: 'app/pages/vulnerability/detail/detail.html',
                title: '漏洞详情'
            });
    }

})();