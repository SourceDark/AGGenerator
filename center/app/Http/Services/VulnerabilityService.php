<?php

namespace App\Http\Services;

use Illuminate\Support\Facades\DB;
use App\Http\Utility\TimeUtility;

class VulnerabilityService
{
    static public function createVulReportBySensorIdAndHostIp($sensor_id, $host_ip) {
        $vul_report_id = DB::table('vul_reports')->insertGetId(
            [
                'sensor_id' => $sensor_id,
                'host_ip' => $host_ip,
                'created_at' => TimeUtility::currentTimeStamp(),
                'updated_at' => TimeUtility::currentTimeStamp()
            ]
        );
        $vul_report = DB::table('vul_reports')->where('id', $vul_report_id)->first();
        return $vul_report;
    }

    static public function createVulReportRecordByRecordAndVulReportId($record, $vul_report_id) {
        $vul_report_record_id = DB::table('vul_report_records')->insertGetId(
            [
                'vul_report_id' => $vul_report_id,
                'port_name' => $record['port_name'],
                'port_proto' => $record['port_proto'],
                'threat' => $record['threat'],
                'cves' => $record['cves'],
                'created_at' => TimeUtility::currentTimeStamp(),
                'updated_at' => TimeUtility::currentTimeStamp()
            ]
        );
    }
}
