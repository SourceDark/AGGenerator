agbotApp.config(['$stateProvider', function($stateProvider) {
    $stateProvider.state('cves', {
        url: '/cves/{page}',
        templateUrl: '/html/cve/list',
        controller: 'cvesCtrl'
    }).state('cve', {
        url: '/cve/{cve_id}',
        templateUrl: '/html/cve/item',
        controller: 'cveCtrl'
    });
}]).controller('cvesCtrl', function ($scope, $http, $stateParams) {
    $scope.currentPage = $stateParams.page;
    $http.get("/api/cve?sort=publishTime,desc&size=10&page=" + ($stateParams.page - 1)).success(function(cves){
        $scope.cves = cves;
        $scope.pages = [];
        for(var i = -4; i < 5; i++) {
            var page = cves.number + i;
            if(page >= 0 && page < cves.totalPages ) {
                $scope.pages.push(page + 1);
            }
        }
    });    
}).controller('cveCtrl', function ($scope, $http, $stateParams) {
    $scope.cveId = $stateParams.cve_id;
    var softwareStarts = ["cpe:/a:", 'cpe:/o:'];
    $http.get("/api/cve/" + $scope.cveId).success(function(cve){
        if(cve.softwareList) {
            cve.softwares = cve.softwareList.split(",").map(function(software) {
                for(var i = 0; i < softwareStarts.length; i++) {
                    softwareStart = softwareStarts[i];
                    if(software.startsWith(softwareStart)) {
                        return software.substr(softwareStart.length);
                    }
                }
                return software;
            }).filter(function(item) { return item; });
        }
        $scope.cve = cve;
    });    
});