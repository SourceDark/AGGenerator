//package org.serc;
//
//import java.io.File;
//import java.text.SimpleDateFormat;
//import java.util.ArrayList;
//import java.util.List;
//
//import javax.xml.parsers.DocumentBuilder;
//import javax.xml.parsers.DocumentBuilderFactory;
//
//import org.serc.model.CveEntry;
//import org.serc.model.Reference;
//import org.serc.repository.CveEntryRepository;
//import org.springframework.beans.factory.annotation.Autowired;
//import org.springframework.boot.CommandLineRunner;
//import org.springframework.stereotype.Component;
//import org.w3c.dom.Document;
//import org.w3c.dom.Element;
//import org.w3c.dom.Node;
//import org.w3c.dom.NodeList;
//
//import com.google.common.collect.Lists;
//
//@Component
//public class CveParser implements CommandLineRunner {
//    
//    @Autowired
//    private CveEntryRepository cveEntryRepository;
//    
//    private Integer parse(String file) {
//        try {
//            SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss");
//            File fXmlFile = new File(file);
//            DocumentBuilderFactory dbFactory = DocumentBuilderFactory.newInstance();
//            DocumentBuilder dBuilder = dbFactory.newDocumentBuilder();
//            Document doc = dBuilder.parse(fXmlFile);
//            doc.getDocumentElement().normalize();
//            NodeList entrys = doc.getElementsByTagName("entry");
//            for (int i = 0; i < entrys.getLength(); i++) {
//                CveEntry cveEntry = new CveEntry();
//                Node entry = entrys.item(i);
//                if (entry.getNodeType() == Node.ELEMENT_NODE) {
//                    Element eElement = (Element) entry;
//                    cveEntry.setId(eElement.getAttribute("id"));
//                    System.out.println(cveEntry.getId());
//                    if(eElement.getElementsByTagName("vuln:cwe").item(0) != null) {
//                        cveEntry.setCwe(eElement.getElementsByTagName("vuln:cwe").item(0).getTextContent());    
//                    }
//                    cveEntry.setPublishTime(dateFormat.parse(eElement.getElementsByTagName("vuln:published-datetime").item(0).getTextContent().substring(0, 19)));
//                    cveEntry.setLastModifiedTime(dateFormat.parse(eElement.getElementsByTagName("vuln:last-modified-datetime").item(0).getTextContent().substring(0, 19)));
//                    cveEntry.setDescription(eElement.getElementsByTagName("vuln:summary").item(0).getTextContent());
//                    
//                    String softwareList = "";
//                    NodeList products = eElement.getElementsByTagName("vuln:product");
//                    for (int j = 0; j < products.getLength(); j++) {
//                        softwareList += products.item(j).getTextContent() + ",";
//                    }
//                    cveEntry.setSoftwareList(softwareList);
//                    
//                    
//                    if(eElement.getElementsByTagName("vuln:cvss").item(0) != null) {
//                        cveEntry.setCvssScore(Double.parseDouble(eElement.getElementsByTagName("cvss:score").item(0).getTextContent()));
//                        cveEntry.setCvssAccessVector(eElement.getElementsByTagName("cvss:access-vector").item(0).getTextContent());
//                        cveEntry.setCvssAccessComplexity(eElement.getElementsByTagName("cvss:access-complexity").item(0).getTextContent());
//                        cveEntry.setCvssAuthentication(eElement.getElementsByTagName("cvss:authentication").item(0).getTextContent());
//                        cveEntry.setCvssConfidentialityImpact(eElement.getElementsByTagName("cvss:confidentiality-impact").item(0).getTextContent());
//                        cveEntry.setCvssIntegrityImpact(eElement.getElementsByTagName("cvss:integrity-impact").item(0).getTextContent());
//                        cveEntry.setCvssAvailabilityImpact(eElement.getElementsByTagName("cvss:availability-impact").item(0).getTextContent());    
//                    }
//                    
//                    NodeList referenceNodes = eElement.getElementsByTagName("vuln:references");
//                    List<Reference> references = new ArrayList<Reference>();
//                    for (int j = 0; j < referenceNodes.getLength(); j++) {
//                        Node referenceNode = referenceNodes.item(j);
//                        Element rElement = (Element) referenceNode;
//                        Reference reference = new Reference();
//                        reference.setType(rElement.getAttribute("reference_type"));
//                        Node reNode = rElement.getElementsByTagName("vuln:reference").item(0);
//                        Element reElement = (Element) reNode;
//                        reference.setTitle(reNode.getTextContent());
//                        reference.setLink(reElement.getAttribute("href"));
//                        references.add(reference);
//                    }
//                    cveEntry.setReferences(references);
//                    cveEntryRepository.save(cveEntry);
//                }
//            }
//            return entrys.getLength();
//        } catch (Exception e) {
//            e.printStackTrace();
//            return 0;
//        }
//    }
//
//    @Override
//    public void run(String... arg0) throws Exception {
//        Integer count = 0;
//        List<String> xmls = Lists.newArrayList(
//            "/Users/xr/tmp/scap-data/nvdcve-2.0-2012.xml",
//            "/Users/xr/tmp/scap-data/nvdcve-2.0-2007.xml",
//            "/Users/xr/tmp/scap-data/nvdcve-2.0-2002.xml",
//            "/Users/xr/tmp/scap-data/nvdcve-2.0-2013.xml",
//            "/Users/xr/tmp/scap-data/nvdcve-2.0-2008.xml",
//            "/Users/xr/tmp/scap-data/nvdcve-2.0-2003.xml",
//            "/Users/xr/tmp/scap-data/nvdcve-2.0-2014.xml",
//            "/Users/xr/tmp/scap-data/nvdcve-2.0-2009.xml",
//            "/Users/xr/tmp/scap-data/nvdcve-2.0-2004.xml",
//            "/Users/xr/tmp/scap-data/nvdcve-2.0-2015.xml",
//            "/Users/xr/tmp/scap-data/nvdcve-2.0-2010.xml",
//            "/Users/xr/tmp/scap-data/nvdcve-2.0-2005.xml",
//            "/Users/xr/tmp/scap-data/nvdcve-2.0-2016.xml",
//            "/Users/xr/tmp/scap-data/nvdcve-2.0-2011.xml",
//            "/Users/xr/tmp/scap-data/nvdcve-2.0-2006.xml");
//        for(String xml : xmls) {
//            count += parse(xml);           
//        }
//        System.out.println(count);
//    }
//
//}
