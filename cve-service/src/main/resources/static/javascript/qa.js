$(document).ready(function(){
	$('#description').html(marked($('#description').attr('data')));
	$(".answer-content").each(function() {
		$(this).html(marked($(this).attr('data')));
	});
	
	$(".btn-publish").click(function(){// validation
		$('.answer-form-alert-content').addClass('hidden');
		$('.answer-form-alert-email').addClass('hidden');
		if($('#content').val().trim() === ''){
	    	return $('.answer-form-alert-content').removeClass('hidden');
	    }
		if($('#email').val().trim() === '') {
			return $('.answer-form-alert-email').removeClass('hidden');
		}
		$('.alert-danger').addClass('hidden');
	    $('form').submit();
	});
	
	$('#content')
    .bind('input propertychange', function(){
        $('#preview').html(marked($('#content').val()));
    })
    .trigger('input');
	$(".btn-delete-question").click(function() {
		if(confirm("是否删除该问题？")) {
			$.ajax({
				type: "delete",
				url: "/" + $(this).attr("data-id"),
				success: function() {
					location.href = "/";
				},
				error: function() {
					alert("操作失败，请查看日志");
				}
			});
		}
	});
	
	$(".delete-answer").click(function() {
		var self = this;
		if(confirm("是否删除该回答？")) {
			$.ajax({
				type: "delete",
				url: "/answers/" + $(this).attr("data-id"),
				success: function() {
					$(self).parents(".answer").remove();
					$(".alert-success").removeClass('hidden');
				},
				error: function() {
					alert("操作失败，请查看日志");
				}
			});
		}
	});
	
	$(".input-placeholder").click(function() {
		$(this).addClass('hidden');
		$(".answer-form").removeClass('hidden');
	});
});